<div class="layui-container" style="margin-top:10px;">
    <div class="layui-row">
        {include file="user/rightmenu" /}
        <div class="layui-col-lg9">

            <table class="layui-hide" id="deviceList" lay-filter="deviceList"></table>
            <script type="text/html" id="barTool">
                <a class="layui-btn layui-btn-xs" lay-event="view">查看</a>
                <a class="layui-btn layui-btn-xs" lay-event="del">删除</a>
            </script>
        </div>
    </div>
</div>
<script type="text/html" id="headToolBar">
    <div class="layui-btn-container">
        <button class="layui-btn layui-btn-sm" lay-event="add">添加</button>
    </div>
</script>
<script>

    layui.use('table', function () {
        var table = layui.table;
        table.render({
            elem: '#deviceList'
            , url: '/api/message/messageList'
            , toolbar: '#headToolBar'
            , title: '消息列表'
            , cols: [[
                {field: 'id', title: '消息ID', width: 80, fixed: 'left'}
                , {field: 'desc', title: '简介', width: 120}
                , {field: 'type', title: '消息类型', width: 120}
                , {field: 'content', title: '内容', width: 150}
                , {field: 'status', title: '状态', width: 120}
                , {field: 'create_at', title: '创建时间', width: 80}
                , {field: 'cmd', title: '命令', width: 120}
                , {fixed: 'right', title: '操作', toolbar: '#barTool', width: 150}
            ]]
            , page: true
            , response: {
                statusCode: 1 //重新规定成功的状态码为 1
            }, parseData: function (res) { //将原始数据解析成 table 组件所规定的数据
                return {
                    "code": res.code, //解析接口状态
                    "msg": res.message, //解析提示文本
                    "count": res.data.total, //解析数据长度
                    "data": res.data.rows //解析数据列表
                };
            }
        });

        //监听头工具栏事件
        table.on('toolbar(deviceList)', function(obj){
            var checkStatus = table.checkStatus(obj.config.id)
                ,data = checkStatus.data; //获取选中的数据
            switch(obj.event){
                case 'add':
                    layer.msg('添加');
                    break;
            };
        });
        //监听行工具事件
        table.on('tool(deviceList)', function (obj) {
            var data = obj.data;
            if (obj.event === 'view') {
                location.href = '/portal/cloud/deviceDetail?device=' + obj.data.device_id;
            }
            if (obj.event === 'del') {
                layer.confirm('确定删除吗？', function (index) {
                    console.log(data);
                    $.ajax({
                        url: '/api/device/deleteDevice', dataType: 'json', type: 'post', data: {
                            'device_id': data.device_id
                        }, success: function (d) {
                            if (d.code == 1) {
                                layer.msg('删除成功！');
                                setTimeout(function () {
                                    location.reload()
                                },800);
                            } else {
                                layer.msg(d.message);
                            }
                        }
                    });
                    console.log(obj.data);
                });
            }
        });
    });
</script>